{
  "version": "2.0.0",
  "inputs": [
    {
      "id": "BuildType",
      "type": "pickString",
      "description": "Select build type",
      "options": ["Debug", "Release"],
      "default": "Release"
    },
    {
      "id": "NetworkInterface",
      "type": "pickString",
      "description": "Select network interface",
      "options": ["lo", "eth0", "enp130s0", "wlp129s0f0"],
      "default": "lo"
    },
    {
      "id": "RosDistro",
      "type": "pickString",
      "description": "Select ROS distribution",
      "options": ["humble", "foxy", "galactic"],
      "default": "humble"
    },
    {
        "id": "Config Path",
        "type": "promptString",
        "description": "Input config path",
        "default": ""
    },
    {
        "id": "Python Version",
        "type": "promptString",
        "description": "Input Python version",
        "default": ""
    },
    {
        "id": "Pytorch Wheel URL",
        "type": "promptString",
        "description": "Input PyTorch wheel URL",
        "default": ""
    },
  ],
  "tasks": [
    {
      "label": "Download ORT",
      "type": "shell",
      "command": "bash scripts/get_ort.sh",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "Convert pt to onnx",
      "type": "shell",
      "command": "${env:HOME}/.local/bin/uv",
      "args": [
          "run","python", "scripts/pt_to_onnx.py",
          "--pt", "${input:Config Path}/policy.pt",
          "--onnx", "${input:Config Path}/policy.onnx", 
          "--config", "${input:Config Path}/config.yaml"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },
    {
      "label": "Download Torch",
      "type": "shell",
      "command": "bash scripts/get_torch.sh ${input:Python Version} ${input:Pytorch Wheel URL}",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "Build",
      "type": "process",
      "command": "bash",
      "args": [
        "scripts/run.sh",
        "${input:NetworkInterface}",
        "${input:RosDistro}",
        "colcon", "build", "--event-handlers", "console_direct+",
        "--packages-up-to", "legged_rl_deploy",
        "--cmake-args", "-DCMAKE_BUILD_TYPE=${input:BuildType}"
      ],
      "group": "build",
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },

    // Controller
    {
      "label": "ROS2: RL",
      "type": "process",
      "command": "bash",
      "args": [
        "scripts/run.sh",
        "${input:NetworkInterface}",
        "${input:RosDistro}",
        "ros2", "run", "legged_rl_deploy", "legged_rl_deploy_node",
        "${input:NetworkInterface}",
        "${workspaceFolder}/${input:Config Path}"
      ],
      "options": { 
        "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },
  ]
}
